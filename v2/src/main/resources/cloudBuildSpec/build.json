{
  "buildPhaseStart": [
    "apt-get update",
    "apt-get install -y git",
    "rm -rf capillary-cloud-tf/stacks/*",
    "cp -r $CODEBUILD_SRC_DIR_STACK/$STACK_SUBDIRECTORY capillary-cloud-tf/stacks/$STACK_NAME",
    "cp -r $CODEBUILD_SRC_DIR_STACK/$STACK_SUBDIRECTORY/schema capillary-cloud-tf/schema",
    "cp -r $CODEBUILD_SRC_DIR_STACK/$STACK_SUBDIRECTORY/seed_data capillary-cloud-tf/seed_data",
    "if [ -d \"$CODEBUILD_SRC_DIR_STACK/$STACK_SUBDIRECTORY/database_views\" ]; then cp -r $CODEBUILD_SRC_DIR_STACK/$STACK_SUBDIRECTORY/database_views capillary-cloud-tf/database_views; fi",
    "cd capillary-cloud-tf/tfaws/",
    "terraform init",
    "if terraform workspace select $CLUSTER_ID; then echo \"workspace exists\"; else terraform workspace new $CLUSTER_ID; fi",
    "terraform init"
  ],
  "tfSteps": [
    {
      "type": "apply",
      "target": "module.overrides",
      "parallelism": 30
    },
    {
      "type": "apply",
      "target": "module.infra",
      "parallelism": 10
    },
    {
      "type": "apply",
      "target": "module.iam",
      "parallelism": 10
    },
    {
      "type": "apply",
      "target": "module.application",
      "parallelism": 10
    },
    {
      "type": "apply",
      "target": "module.disaster-recovery",
      "parallelism": 10
    }
  ],
  "buildPhaseEnd": [
    "python3 scripts/report.py"
  ]
}